<!DOCTYPE html>
<html lang="en-us">
<html>
	<head>
		<button id="run">Check</button>
    <h3>Output:</h3> 
    <div id="output2">Waiting4Check</div>
	</head>
	<body> 
<script type="module">
   import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.7.0'; 
    import { client } from "https://cdn.jsdelivr.net/npm/@gradio/client@0.1.4/dist/index.min.js";
    const generate = document.getElementById("run");   
    generate.addEventListener("click", async () =>{
        try {         
env.useBrowserCache=true;
env.allowLocalModels=true;
let pipe = await pipeline('text-classification');
let output = await pipe('When life gives us difficult situations, how do we deal with them? This is the question that Nathaniel Drew attempts to tackle with this video, and through his journey to Vienna he uncovers some key concepts that work toward an answer to this question. The uncertainty that exists in the world, especially now, is something that can make us indecisive and unsure of our role in it all. Yet by keeping some key ideas in mind, it is possible to navigate this landscape. Firstly, the challenges we encounter are there to teach us. There are times when we must change,and the problems are there to guide us along the way. It is equally important to know your friends, and who you can rely on. When things get serious, it becomes clear who you can trust. In addition, everyone goes through certain phases of life that are always shifting. It is critical to find goals that align with where you are in the present moment. Another element to consider is the objective lack of control that we have on events external to us. By focusing on what we can control, we make the largest impact. Lastly, approaching each situation and experience with openness and curiosity allows for a better outlook, and inspires us to look forward instead of backward.');
//new action
        const celscilist = {
          'dd': { 'info': { 'views': 126000, 'link': "https://youtu.be/IZefk4gzQt4"} },
          'jp': { 'info': { 'views': 952791, 'link': "https://youtu.be/3Pup-XSH98o" } },
              };
          // Extract 'views' values into an array
          const viewsArray = Object.values(celscilist).map(item => item.info.views);
          // Calculate the sum of 'views' values
          function calculateAverage(viewsArray ) {
            const sum = viewsArray.reduce((accumulator, currentValue) => accumulator + currentValue, 0);       
            return sum / viewsArray.length;
          }         
          class Celsci {
            static iscelsci(x) {
              let y = "Not Above Average: ";
              if (x > calculateAverage(viewsArray)) {
                y = "Above Average: ";
              }
              return y;
            }             
            static iscelscinow(x) {
              let y = "Not Above Average: ";
              if (x > calculateAverage(viewsArray)) {
                y = "Above Average: ";
              }
              return y;
            }
          }      
          function checkcelsci(x) {
            const result = Celsci.iscelsci(celscilist[x]['info']['views']);
            return result;
          }
          //new
        //async function checkcelscinow(x){
          const app = await client("https://cognitivescience-cogsphere.hf.space");
          const lastview = await app.predict("/predict", [      
            celscilist["dd"]['info']['link'], 
          ]);
           //result=result.data; //Celsci.iscelscinow(result.data);
        //return result.data            
        //   
        // Get the max value from the array
        const maxViews = Math.max(...viewsArray);        
        function findKeyByViews(obj, viewsValue) {
          return Object.keys(obj).find(key => obj[key].info.views === viewsValue);
        };
        // Call the function with data and maxViews as arguments
        let no1 = findKeyByViews(celscilist, maxViews);
        //new    
        document.write("dd with views: ",celscilist["dd"]['info']['views'] , " is: " , checkcelsci('dd'), Math.trunc(calculateAverage(viewsArray)), " and the #1 is: ", no1, " with viewcounts of ", maxViews, " but dd sentiment result is ", JSON.stringify(output), " with latest views: ", lastview.data);                 
            } catch (error){
                 console.log("Error:",error.message);       
            }   
        }       
)
    </script>
    </body>
</html>
